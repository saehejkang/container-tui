---
phase: 01-panel-layout-visuals
plan: "04"
type: execute
wave: 3
depends_on:
  - "01-02"
  - "01-03"
files_modified:
  - ui/system/view.go
  - ui/components/help_overlay.go
  - ui/components/footer.go
autonomous: false
requirements:
  - TUI-01
  - TUI-04

must_haves:
  truths:
    - "The TUI shows a left panel listing all containers and a right panel simultaneously"
    - "Left panel width is ~1/3 of terminal width; right panel fills the rest"
    - "When no containers are found, the left panel shows 'No containers' placeholder text"
    - "When loading, the left panel shows 'Loading...' text"
    - "Pressing ? opens a help overlay showing all keybindings; pressing ? or Esc closes it"
    - "The help overlay renders as a centered box on top of the layout"
    - "Footer shows updated keybindings including ? for help"
  artifacts:
    - path: "ui/system/view.go"
      provides: "Updated RenderSystem that renders container list + right pane + optional overlay"
      min_lines: 60
    - path: "ui/components/help_overlay.go"
      provides: "RenderHelpOverlay function returning centered help box string"
      exports: ["RenderHelpOverlay"]
      min_lines: 30
    - path: "ui/components/footer.go"
      provides: "Updated footer text with ? keybinding"
      contains: "?"
  key_links:
    - from: "ui/system/view.go"
      to: "ui/components/RenderContainerRow"
      via: "import and call in left panel loop"
      pattern: "RenderContainerRow"
    - from: "ui/system/view.go"
      to: "ui/components/RenderHelpOverlay"
      via: "conditional render when m.ShowHelp"
      pattern: "ShowHelp"
    - from: "ui/system/view.go"
      to: "model.Containers"
      via: "range loop over containers slice"
      pattern: "m\\.Containers"
---

<objective>
Wire all rendering together: the multi-pane layout (container list left, detail pane right), the help overlay, and updated footer keybindings.

Purpose: Plans 01-03 built the data model, rendering components, and state machine. This plan assembles them into the final visible TUI.
Output: Updated view.go composing the new layout, help_overlay.go, updated footer.go.
</objective>

<execution_context>
@/Users/kevingeorge/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kevingeorge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-panel-layout-visuals/01-02-SUMMARY.md
@.planning/phases/01-panel-layout-visuals/01-03-SUMMARY.md
@ui/system/view.go
@ui/components/styles.go
@ui/components/header.go
@ui/components/footer.go
@ui/components/container_row.go
@ui/system/model.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite RenderSystem for multi-pane layout</name>
  <files>ui/system/view.go</files>
  <action>
Replace the contents of ui/system/view.go. The new RenderSystem builds a two-panel layout using the Container data from the model.

Layout structure:
```
[Header]
[Left Panel (containers)] | [Right Panel (detail/placeholder)]
[Footer]
```

Implementation:

1. Guard against zero dimensions at the top of RenderSystem:
```go
if m.Width == 0 || m.Height == 0 {
    return "Initializing..."
}
```

2. Compute panel widths:
```go
leftWidth := m.Width / 3
rightWidth := m.Width - leftWidth - 2  // -2 for border/margin
```

3. Render the header. The system status (isRunning) is now derived from containers:
```go
isRunning := false
for _, c := range m.Containers {
    if c.Status == "running" {
        isRunning = true
        break
    }
}
header := components.RenderHeaderWithStatus("Container TUI", isRunning)
```

4. Build the left panel (container list):
   - If m.Loading: show "  Loading..." as the only line
   - If len(m.Containers) == 0 and !m.Loading: show "  No containers" as the only line
   - Otherwise: for each container i, call components.RenderContainerRow(c, i == m.SelectedIndex, leftWidth)
   - Join rows with "\n"
   - Apply MenuStyle.Copy().Width(leftWidth) to the full joined string

5. Build the right panel placeholder:
   - Content: "Select a container to view details" (centered, muted color)
   - Apply OutputBoxStyle.Copy().Width(rightWidth)

6. Compose body:
```go
body := lipgloss.JoinHorizontal(lipgloss.Top, leftPanel, rightPanel)
```

7. Render footer with updated keybindings:
```go
footer := components.RenderFooter("↑/↓  Navigate  •  ?  Help  •  q  Quit", m.Width)
```

8. Base layout (no overlay):
```go
baseLayout := lipgloss.JoinVertical(lipgloss.Top, header, body, footer)
```

9. If m.ShowHelp is true, overlay the help panel:
```go
if m.ShowHelp {
    overlay := components.RenderHelpOverlay(m.Width, m.Height)
    return lipgloss.Place(m.Width, m.Height, lipgloss.Center, lipgloss.Center, overlay)
}
return baseLayout
```

Imports: "container-tui/ui/components", "github.com/charmbracelet/lipgloss"
Remove all imports of "container-tui/ui/system/subcommands" (no longer needed).
  </action>
  <verify>
`go build ./...` — must compile with zero errors.
  </verify>
  <done>
view.go renders a two-column layout. Left panel shows container rows via RenderContainerRow. Right panel shows placeholder text. Header derives isRunning from container statuses. When m.ShowHelp is true, lipgloss.Place centers the help overlay. Zero-dimension guard prevents layout math panics. Compiles.
  </done>
</task>

<task type="auto">
  <name>Task 2: Help overlay and updated footer</name>
  <files>ui/components/help_overlay.go, ui/components/footer.go</files>
  <action>
**ui/components/help_overlay.go** — create new file in package `components`:

```go
package components

import (
    "github.com/charmbracelet/lipgloss"
)

func RenderHelpOverlay(width, height int) string {
    content := lipgloss.JoinVertical(lipgloss.Left,
        lipgloss.NewStyle().Bold(true).Render("Keyboard Shortcuts"),
        "",
        "↑ / k       Move up",
        "↓ / j       Move down",
        "?           Toggle this help",
        "Esc         Close help",
        "q / Ctrl+C  Quit",
    )

    box := lipgloss.NewStyle().
        Border(lipgloss.RoundedBorder()).
        BorderForeground(lipgloss.Color("#0A84FF")).
        Background(lipgloss.Color("#1F1F1F")).
        Foreground(lipgloss.Color("#FFFFFF")).
        Padding(1, 3).
        Render(content)

    return box
}
```

**ui/components/footer.go** — read the existing file and update the keybinding hint string. The RenderFooter function likely accepts a hint string parameter — if it does, no change needed here (the hint is passed from view.go). If the hint is hardcoded inside footer.go, update it to include "?  Help". Read the file first before editing to understand which case applies.

After reading footer.go:
- If hint string is a parameter: no change needed (view.go already passes the updated string in Task 1).
- If hint is hardcoded: update to: "↑/↓  Navigate  •  ?  Help  •  q  Quit"

Keep existing RenderFooter signature and FooterStyle intact.
  </action>
  <verify>
`go build ./...` — must compile with zero errors.
`go vet ./...` — no warnings.
Run the binary: `go build -o /tmp/ctui-test . && timeout 3 /tmp/ctui-test; true` — it should not crash immediately on startup.
  </verify>
  <done>
help_overlay.go exists and exports RenderHelpOverlay(width, height int) string. The overlay renders a rounded-border box with all keybindings listed. footer.go includes ? keybinding hint. `go build ./...` passes. TUI launches without crashing.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Visual verification of complete Phase 1 TUI</name>
  <action>Human verifies the full Phase 1 layout visually in a terminal session.</action>
  <verify>All nine verification steps below pass: layout, colors, resource bars, help overlay, navigation, auto-refresh, and clean quit.</verify>
  <done>User confirms "approved" — all four requirements TUI-01, TUI-02, TUI-03, TUI-04 are visually confirmed working.</done>
  <what-built>
Complete Phase 1 TUI: multi-pane layout with container list panel (left), detail placeholder (right), color-coded status indicators with resource bars per container row, and ? help overlay.
  </what-built>
  <how-to-verify>
1. Build and run: `go build -o /tmp/container-tui . && /tmp/container-tui`
2. Verify the layout shows two panels side by side (container list on left, right pane visible)
3. If containers exist: confirm each row shows a colored dot (green/gray/red) and resource bar characters
4. If no containers: left panel shows "No containers" placeholder
5. Press ? — confirm a centered help overlay appears listing all keybindings
6. Press ? or Esc — confirm overlay dismisses and layout returns to normal
7. Press up/down or j/k — confirm selected row highlights change in the container list
8. Wait 5+ seconds — confirm list auto-refreshes (no crash, no freeze)
9. Press q — TUI exits cleanly
  </how-to-verify>
  <resume-signal>Type "approved" if all checks pass, or describe what's broken</resume-signal>
</task>

</tasks>

<verification>
`go build ./...` passes.
`go vet ./...` passes.
Two-panel layout visible in terminal.
Container rows show colored status dots and resource bars.
? key opens/closes help overlay.
Navigation with up/down/j/k updates selected highlight.
Auto-refresh runs every 5 seconds without crash.
</verification>

<success_criteria>
Phase 1 visual goal is achieved: users see a polished, Lazydocker-style TUI with live container status at a glance. All four requirements (TUI-01, TUI-02, TUI-03, TUI-04) are visually confirmed by the user.
</success_criteria>

<output>
After completion, create `.planning/phases/01-panel-layout-visuals/01-04-SUMMARY.md`
</output>
