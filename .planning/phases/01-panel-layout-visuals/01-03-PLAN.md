---
phase: 01-panel-layout-visuals
plan: "03"
type: execute
wave: 2
depends_on:
  - "01-01"
files_modified:
  - ui/system/model.go
  - main.go
autonomous: true
requirements:
  - TUI-01

must_haves:
  truths:
    - "The root Model struct holds a []pkg.Container slice and a selected cursor index"
    - "On startup, FetchContainers() is called automatically (no user action required)"
    - "Pressing '?' toggles a ShowHelp bool field on the Model"
    - "Width and Height are guarded: layout math never executes with 0 dimensions"
    - "The container list refreshes on a tea.Tick every 5 seconds"
  artifacts:
    - path: "ui/system/model.go"
      provides: "Updated Model with Containers, SelectedIndex, ShowHelp, and ticker"
      contains: "ShowHelp"
      min_lines: 80
  key_links:
    - from: "ui/system/model.go"
      to: "pkg.FetchContainers"
      via: "Init() tea.Cmd"
      pattern: "FetchContainers"
    - from: "ui/system/model.go"
      to: "pkg.FetchContainersMsg"
      via: "Update() type switch"
      pattern: "FetchContainersMsg"
---

<objective>
Rearchitect the root system Model to own a container list (not a subcommand menu), handle container selection cursor, help overlay toggle, and auto-refresh.

Purpose: The model is the state machine driving the entire TUI. Rebuilding it to hold container data instead of subcommand pointers is the central structural change of Phase 1.
Output: ui/system/model.go fully rearchitected; main.go updated to match new constructor signature.
</objective>

<execution_context>
@/Users/kevingeorge/.claude/get-shit-done/workflows/execute-plan.md
@/Users/kevingeorge/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-panel-layout-visuals/01-01-SUMMARY.md
@ui/system/model.go
@main.go
@pkg/containers.go
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rearchitect Model struct and Update handler</name>
  <files>ui/system/model.go</files>
  <action>
Replace the contents of ui/system/model.go. The new model owns container state instead of subcommand state.

New Model struct:
```go
type Model struct {
    Containers    []pkg.Container
    SelectedIndex int
    ShowHelp      bool
    Width         int
    Height        int
    Loading       bool
    Error         string
}
```

Remove: Cursor, Subcommands, ActiveView fields.

New constructor:
```go
func NewSystemModel() *Model {
    return &Model{
        Loading: true,
    }
}
```

New Init():
```go
func (m *Model) Init() tea.Cmd {
    return tea.Batch(
        pkg.FetchContainers(),
        tickRefresh(),
    )
}
```

tickRefresh is a private function that returns a tea.Cmd using tea.Tick with a 5-second interval:
```go
type refreshTickMsg struct{}

func tickRefresh() tea.Cmd {
    return tea.Tick(5*time.Second, func(t time.Time) tea.Msg {
        return refreshTickMsg{}
    })
}
```

New Update() handler — handle these message types:

1. tea.WindowSizeMsg: set m.Width, m.Height. Guard: only update if msg.Width > 0 && msg.Height > 0.

2. pkg.FetchContainersMsg: set m.Containers = []pkg.Container(msg), m.Loading = false. Clamp m.SelectedIndex to [0, len(m.Containers)-1] (guard for empty list: if len == 0, SelectedIndex = 0).

3. refreshTickMsg: return tea.Batch(pkg.FetchContainers(), tickRefresh()) to re-fetch and re-schedule next tick.

4. tea.KeyMsg:
   - "q", "ctrl+c": return m, tea.Quit
   - "?": toggle m.ShowHelp = !m.ShowHelp
   - "esc": if m.ShowHelp, set m.ShowHelp = false
   - "up", "k": if !m.ShowHelp && m.SelectedIndex > 0, decrement m.SelectedIndex
   - "down", "j": if !m.ShowHelp && m.SelectedIndex < len(m.Containers)-1, increment m.SelectedIndex

5. default: return m, nil

Imports needed: "time", "container-tui/pkg", tea "github.com/charmbracelet/bubbletea"

Remove all imports of "container-tui/ui/system/subcommands" — that package is no longer used by the model.

Keep: func (m *Model) View() string { return RenderSystem(m) }
  </action>
  <verify>
`go build ./...` — note: this will likely fail until main.go is updated in Task 2. Run `go build ./ui/system/` to verify the model package compiles independently.
  </verify>
  <done>
ui/system/model.go uses the new Model struct (Containers, SelectedIndex, ShowHelp, Width, Height, Loading, Error). Init() returns FetchContainers() + tickRefresh(). Update() handles FetchContainersMsg, refreshTickMsg, WindowSizeMsg, and KeyMsg with ?, esc, up/k, down/j, q/ctrl+c keys. No reference to Subcommands, ActiveView, or subcommands package.
  </done>
</task>

<task type="auto">
  <name>Task 2: Update main.go for new constructor</name>
  <files>main.go</files>
  <action>
Update main.go to match the new constructor signature.

Replace:
```go
subcommandsList := []string{"start", "stop", "status"}
systemModel := system.NewSystemModel(subcommandsList)
```

With:
```go
systemModel := system.NewSystemModel()
```

Remove the now-unused `subcommandsList` variable. Keep all other code (tea.NewProgram, WithAltScreen, error handling) unchanged.

Verify imports: "fmt", "os", "container-tui/ui/system", tea "github.com/charmbracelet/bubbletea" — all still needed.
  </action>
  <verify>
`go build ./...` from project root — must compile with zero errors. The full build succeeds only after both Tasks 1 and 2 are complete.
  </verify>
  <done>
main.go calls system.NewSystemModel() with no arguments. `go build ./...` passes. `go vet ./...` passes.
  </done>
</task>

</tasks>

<verification>
`go build ./...` passes from project root.
`go vet ./...` passes.
Model struct has: Containers []pkg.Container, SelectedIndex int, ShowHelp bool, Width int, Height int, Loading bool, Error string.
Init() calls pkg.FetchContainers() and schedules 5-second refresh tick.
'?' key toggles ShowHelp. 'esc' closes help. Arrow/j/k navigate SelectedIndex.
</verification>

<success_criteria>
Root model is rearchitected. Containers are fetched on startup automatically. SelectedIndex navigates the list. ShowHelp toggles on '?'. Auto-refresh fires every 5 seconds. All compiles.
</success_criteria>

<output>
After completion, create `.planning/phases/01-panel-layout-visuals/01-03-SUMMARY.md`
</output>
